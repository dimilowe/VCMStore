You are the AI developer inside this Replit.
Build a production-ready, lightweight full-stack web app called:
“AI Calorie Deficit Calculator”
Tagline: Snap your food + Health app screenshot → see today’s surplus or deficit.
1. Tech Stack
Use:
Node.js + Express backend
Vanilla HTML/CSS/JS frontend (no React, no frameworks)
OpenAI API (vision) for analyzing images
Model: gpt-4o-mini (or gpt-4o if mini isn’t available)
No database, no auth, no build tools.
2. File Structure
Create this structure:
index.js – Express server
package.json
public/
index.html
styles.css
app.js
favicon.ico (simple calorie / fire icon from emoji-style SVG)
views/ – not needed (everything is static in public)
config/
openai.js – OpenAI client setup
.env – use OPENAI_API_KEY
.gitignore – ignore node_modules/ and .env
README.md
Serve public as static assets from Express.
3. Environment & Dependencies
In package.json include:
"express"
"multer" (for multipart image upload)
"dotenv"
"openai" (official Node SDK)
Set "type": "module" so you can use ES modules.
Example npm scripts:
"start": "node index.js"
4. Backend – Express API
4.1 Server setup (index.js)
Load .env with dotenv.
Import and configure Express.
Use express.json() only for non-file routes.
Serve static files from public/.
Listen on process.env.PORT || 3000.
4.2 File upload handling
Use multer with memoryStorage() so files stay in memory.
Expect two file fields:
foodImage – photo of a meal
healthScreenshot – screenshot of iPhone Health app showing calories burned
Limit file size to ~5MB each.
Accept only image MIME types: image/jpeg, image/png, image/heic if supported.
4.3 API Route
Create a POST route:
POST /api/calculate-deficit
Behavior:
Validate that at least foodImage is present.
healthScreenshot is optional, but encourage it in the response.
If files missing or invalid → respond with 400 and JSON error.
For each provided image, call OpenAI Vision with the corresponding instructions.
Combine both results into a single structured JSON response.
5. OpenAI Integration (config/openai.js + route logic)
5.1 Client setup
config/openai.js:
Export a configured OpenAI client using process.env.OPENAI_API_KEY.
If the key is missing, log a clear error and prevent the server from starting.
5.2 Vision calls
In the API route, call OpenAI like this (conceptually):
For the food image:
Convert file buffer to base64.
Call openai.chat.completions.create with:
model: "gpt-4o-mini" (or "gpt-4o")
Single messages array with role: "user" and content as multi-part:
First part: image (base64)
Second part: text instructions:
“You are a nutrition assistant. Look at this photo of a meal and estimate the total calories.
Return a strict JSON object with this shape and nothing else:
{ "estimatedCalories": number, "confidence": number, "description": string, "items": [ { "name": string, "estimatedCalories": number } ] }
estimatedCalories must be an integer for the whole meal.
confidence is a number between 0 and 1.
description is 1 short sentence.
items is a short list of recognizable components.”
Parse the JSON from the response.
For the Health screenshot (if provided):
Same image encoding.
Instructions:
“You are reading an iPhone Health or fitness tracker screenshot.
Extract the total calories burned today if visible (preferably ‘Active calories’ or ‘Calories burned’ values).
Return strict JSON only in this shape:
{ "activeCalories": number | null, "totalCalories": number | null, "note": string }
If you cannot reliably find a value, set it to null and explain in note.”
Again, parse JSON safely.
5.3 Deficit / surplus calculation
After receiving both JSON objects:
Let foodCalories = food.estimatedCalories.
Let burnedCalories be:
health.activeCalories if present
else health.totalCalories
else null.
Compute:
If burnedCalories is not null:
net = burnedCalories - foodCalories
If net > 50 → status = "deficit"
If net < -50 → status = "surplus"
Else → status = "roughly even"
If burnedCalories is null, set status = "unknown" and message telling user you couldn’t read the burn yet.
Also compute projected weekly change if status !== "unknown":
weeklyNet = net * 7
Approximate kg or lbs change, assuming:
7700 kcal ≈ 1 kg
3500 kcal ≈ 1 lb
Return both.
5.4 API JSON response
Return JSON like:
{
  "food": {
    "estimatedCalories": 650,
    "confidence": 0.82,
    "description": "Grilled chicken with rice and vegetables.",
    "items": [
      { "name": "Grilled chicken", "estimatedCalories": 300 },
      { "name": "Rice", "estimatedCalories": 250 },
      { "name": "Vegetables", "estimatedCalories": 100 }
    ]
  },
  "health": {
    "activeCalories": 430,
    "totalCalories": null,
    "note": "Read from Active Calories metric."
  },
  "summary": {
    "netCalories": -220,
    "status": "surplus",
    "dailyMessage": "Based on this meal and your calories burned so far, you're roughly 220 calories in surplus today.",
    "weeklyProjection": {
      "netCalories": -1540,
      "changeKg": -0.2,
      "changeLbs": -0.44,
      "projectionMessage": "If you repeated this exact pattern daily, you'd gain about 0.44 lbs per week."
    }
  }
}
On errors (OpenAI failure, JSON parse issues, etc.), return:
{
  "error": true,
  "message": "Human-readable error message."
}
Use try/catch; never crash the server.
6. Frontend – public/index.html
6.1 Layout
Create a single-page layout:
Top section (hero):
H1: “AI Calorie Deficit Calculator”
Subheading: “Snap your food and Health app screenshot. See today’s surplus or deficit in seconds.”
Short bullet list of steps.
Main form:
File input for Food Photo (foodImage):
Label: “1. Upload a photo of your meal”
Show a small thumbnail preview after selection.
File input for Health Screenshot (healthScreenshot):
Label: “2. Upload a screenshot of your Health/Fitness app calories”
Also show preview.
Button: “Calculate My Deficit”
Secondary text button: “Clear Inputs” to reset form.
Results section:
Initially hidden.
After successful calculation, show:
Card for Food Estimate
Estimated calories, confidence %, breakdown table.
Card for Calories Burned
Active / total calories, note.
Highlight card for Today’s Status
Large number: “Net: -220 kcal”
Tag: “Calorie Surplus” (red) / “Calorie Deficit” (green) / “Even” (gray)
Weekly projection line.
Error state card if any error occurs.
Footer:
Text: “Built as a free tool on VCM Suite.”
Link: https://vcmsuite.com (open in new tab).
6.2 SEO elements
In <head>:
<title>Calorie Deficit Calculator – AI Photo Estimator | VCM Suite</title>
<meta name="description" content="Free AI calorie deficit calculator. Upload a photo of your meal and a screenshot of your Health app to instantly see your daily calorie surplus or deficit.">
Open Graph tags for sharing:
og:title, og:description, og:type=website, og:url, og:image (use a generic image in /public/og-image.png – simple static graphic).
<link rel="icon" href="/favicon.ico" />
One <h1> and clear section headings.
Add a short FAQ below results area, with collapsible Q&A or simple headings:
“What is a calorie deficit?”
“How accurate is this AI estimate?”
“Do I have to upload a Health screenshot?”
“Can I use this for bulking (calorie surplus)?”
6.3 Accessibility
Use proper labels for inputs.
Use button elements, not clickable divs.
Add aria-live="polite" to result container so screen readers get updates.
7. Frontend – public/app.js
Implement:
Grab form elements and file inputs.
When user selects files, show preview thumbnails using URL.createObjectURL.
On form submit:
Prevent default.
Validate at least foodImage is present; if not, show error message.
Create FormData and append files.
Show loading state (disable button, show spinner text like “Calculating…”).
fetch('/api/calculate-deficit', { method: 'POST', body: formData }).
Handle response:
If response.ok and no error field:
Render result cards using the JSON structure.
Color-code the status:
Green for deficit
Red for surplus
Gray for even / unknown
If error:
Show red error box with data.message or generic message.
Clear button:
Reset file inputs, previews, result section, and messages.
Handle network errors gracefully (e.g., show “Something went wrong. Try again in a minute.”).
8. Styling – public/styles.css
Goal: Clean, modern, mobile-first, no frameworks.
Use a simple system font stack.
Background: very light gray; cards with white background, soft shadows, rounded corners.
Primary accent color: something like orange/red for “calories” theme.
Buttons:
Primary: solid accent color, white text, rounded.
Hover states.
Make layout responsive:
Mobile: single column.
Desktop: form and result cards centered with max-width ~900px.
Use subtle color badges for status:
.badge-deficit (green)
.badge-surplus (red)
.badge-even (gray)
No CSS frameworks; just well-organized custom CSS.
9. README
Write a concise README.md explaining:
What the app does.
How to run it locally:
npm install
Set OPENAI_API_KEY in .env
npm start
Basic explanation of how it estimates calories.
Warning that it’s not medical advice and only rough estimation.
Add a NOTE section:
“This tool is for informational purposes only and should not replace professional medical or nutritional advice.”
10. General Quality Requirements
Code must be clean, commented where non-obvious, and modular.
All OpenAI calls must be wrapped in try/catch with good error messages.
Never expose the API key to the frontend.
Don’t log entire images or huge payloads to console.
Make sure the app starts without crashing even if OpenAI errors; the API should return JSON errors instead.
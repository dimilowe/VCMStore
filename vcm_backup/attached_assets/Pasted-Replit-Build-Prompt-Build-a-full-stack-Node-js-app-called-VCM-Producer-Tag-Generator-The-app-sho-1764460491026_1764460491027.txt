Replit Build Prompt:
Build a full-stack Node.js app called “VCM Producer Tag Generator”.
The app should:
Let users upload a beat or vocal (MP3/WAV).
Add a producer tag voice at intervals.
Support default tags (pre-recorded “vcmsuite.com” style) and AI-generated custom tag phrases using OpenAI TTS.
Return a downloadable, tagged audio file.
Include an SEO-ready landing page targeting the keyword “producer tag”.
1. Tech stack
Node.js + Express.
multer for file uploads.
fluent-ffmpeg (or similar) for audio processing.
openai Node SDK for TTS.
Serve a simple frontend via static files (public/).
Add ffmpeg as a dependency and configure the app so it can run on Replit (assume ffmpeg is available on the PATH or document how to install).
2. Project structure
index.js (main server)
routes/tag.js (or inline in index.js, your choice)
public/index.html (landing page + UI)
public/style.css
public/main.js
tags/ (folder with pre-recorded default tags)
tags/vcmsuite.wav
tags/vcmsuite_dot_com.wav
tag_cache/ (folder for AI-generated tag audio)
output/ (folder for processed files)
Use .gitignore to ignore output/ and tag_cache/ if needed.
3. Environment variables
OPENAI_API_KEY → used by the OpenAI TTS client.
If OPENAI_API_KEY is missing and user requests a custom tag, return a clear error.
4. API design
Implement these endpoints:
GET /health
Returns JSON: { status: "ok" }
POST /api/tag
Accepts multipart/form-data:
file → audio file (.mp3 or .wav), max 30 MB.
mode → 'default' | 'custom'.
defaultTag (optional) → 'vcmsuite' | 'vcmsuite_dot_com' (only used in default mode).
intervalSeconds (optional, number, default 15).
tagVolumeDb (optional, number, default -5).
phrase (required if mode === "custom").
voiceId (required if mode === "custom", e.g. 'female_soft', 'male_hype', 'robotic').
Validation rules:
Reject if no file.
Reject if file > 30 MB.
Reject if extension is not .mp3 or .wav.
If mode === "custom":
Require phrase and voiceId.
If OPENAI_API_KEY missing, respond with 500 and error message.
Response:
On success: { downloadUrl: "/downloads/<filename>" }
On error: { error: "message" } with appropriate HTTP status.
GET /downloads/:filename
Streams the processed file from the output/ directory.
Only allow files that actually exist and match a safe pattern like ^output_[a-zA-Z0-9_-]+\.mp3$.
5. Tag generation logic
5.1 Default tags
Place two WAV files in tags/:
tags/vcmsuite.wav
tags/vcmsuite_dot_com.wav
When mode === "default":
Choose the tag file based on defaultTag (with a sane default).
5.2 Custom AI voice tags (OpenAI TTS)
Implement a helper function:
async function getOrCreateTagVoice(phrase, voiceId) { ... }
Behavior:
Normalize phrase: normalized = phrase.trim().toLowerCase().
Compute a SHA1 hash of voiceId + ":" + normalized.
File path: tag_cache/<hash>.mp3.
If that file already exists → return that path (cache hit).
If not:
Call OpenAI TTS via the openai Node SDK:
Use a TTS model like "gpt-4o-mini-tts" (or the latest TTS model).
Map voiceId values (female_soft, male_hype, etc.) to real OpenAI voice names.
Input text is the phrase.
Save the resulting audio as tag_cache/<hash>.mp3.
Return this file path.
In POST /api/tag, when mode === "custom", call getOrCreateTagVoice(phrase, voiceId) to get the tag audio file path.
6. Audio processing with ffmpeg
Use fluent-ffmpeg to:
Load the uploaded user file (from multer).
Determine full duration in seconds.
Generate timestamps every intervalSeconds seconds (starting at a short offset like 1–2 seconds so it’s not on the very first millisecond).
For each timestamp, mix the tag audio file at that point.
Also duck (lower) the main audio by ~3dB under the tag for ~0.8 seconds around each insertion (sidechain-style).
Implementation expectations:
Use ffmpeg filter chains:
Example approach: use adelay on copies of the tag to shift them to the right time, then mix them with amix.
For ducking, you can use volume filters around those positions, or a simpler overall main volume drop when each tag plays.
Output should be an MP3 file saved as:
output/output_<uuid>.mp3 (use crypto.randomUUID() or similar).
If processing fails, log the error and return a 500 response with { error: "Audio processing failed" }.
Clean up temporary uploaded files after processing.
7. Frontend: SEO landing page + UI
Build a single-page UI in public/index.html that:
Has SEO-friendly meta info targeting “producer tag”:
<title>Free Producer Tag Generator – VCM Producer Tag Voice Maker</title>
Meta description: mention “producer tag”, “producer tag voice generator”, “make your own producer tag”.
Main <h1>: “Free Producer Tag Generator”
Subheading referencing: “Create a custom producer tag voice or use a default tag to protect your beats and vocals.”
UI elements:
File input (accept="audio/*").
Radio buttons or select for mode:
Use default VCM producer tag
Create custom producer tag (AI voice)
If default:
Dropdown to choose:
“vcmsuite” (default)
“vcmsuite.com”
If custom:
Text input for phrase (placeholder like “e.g. Dimi Lowe Exclusive”).
Dropdown for voiceId with options:
“Female soft”
“Male hype”
“Robotic”
Number input for intervalSeconds with sensible default (e.g. 15).
Number input for tagVolumeDb default -5 (negative values lower volume).
“Generate Producer Tag” button.
Status area that shows:
“Uploading…”
“Processing…”
Error messages from the server.
On success, display:
“Your tagged track is ready” with a clickable download link using the returned downloadUrl.
At the bottom of the page, add SEO-friendly text (~300–500 words) explaining:
What a producer tag is.
Why producers use tags.
How this tool works in simple terms.
Mention related phrases:
“producer tag voice generator”
“producer tag download”
“make your own producer tag”
public/main.js
Handles:
Form submission.
Builds a FormData object with all fields.
Sends fetch("/api/tag", { method: "POST", body: formData }).
Parses JSON response.
Updates the UI with status or download link.
Handles error messages from server.
public/style.css
Basic clean styling:
Centered container.
Responsive layout.
Clear headings and labels.
Nice looking button and inputs (but no framework needed).
8. Logging & errors
Log:
Upload start and end.
Mode used (default or custom).
Cache hits vs misses for custom tags.
ffmpeg errors.
Return clear error messages to the frontend as JSON.
9. Start script
In package.json, set:
"start": "node index.js"
Ensure the app listens on process.env.PORT || 3000.
After finishing, I should be able to:
Run the Replit.
Open the web view.
See an SEO-friendly Producer Tag Generator landing page.
Upload a beat or vocal.
Choose default or custom tag.
Get back a downloadable, tagged audio file.
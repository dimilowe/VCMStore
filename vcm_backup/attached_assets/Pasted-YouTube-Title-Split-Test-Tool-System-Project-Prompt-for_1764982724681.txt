YouTube Title Split-Test Tool
System / Project Prompt for Replit AI:
You are an AI coding assistant inside a brand-new Replit project.
Build a full-stack web app called “YouTube Title Split-Test Tool”.
The app lets creators:
Connect their YouTube channel via OAuth
Select a video
Enter 2–5 title variants
Automatically rotate titles on a schedule (e.g. every 2–4 hours)
Fetch impressions + views per variant
Rank the winning title by CTR and allow the user to “Set as Final Title”
This MUST be coded as a single repo that can be deployed directly from Replit.
1. Tech Stack
Use this exact stack:
Backend:
Node.js + Express
googleapis (for YouTube Data API + OAuth2)
sqlite3 (file-based DB) or better-sqlite3
node-cron (for rotation scheduler)
cookie-session (simple session-based auth)
Frontend:
Server-rendered HTML (EJS templates) + minimal vanilla JS
(No React, no frontend build pipeline. Keep it simple and fast.)
Styling:
Tailwind via CDN in <head> (no build step).
2. Environment Variables
Expect these environment variables to be set in Replit:
GOOGLE_CLIENT_ID
GOOGLE_CLIENT_SECRET
GOOGLE_REDIRECT_URI
(e.g. https://<your-repl-name>.<your-username>.repl.co/oauth2/callback)
SESSION_SECRET (random string for cookie-session)
Do not hardcode any secrets.
3. OAuth & YouTube API Requirements
Use the Google APIs Node client (googleapis).
Scopes
Request these scopes from the user:
https://www.googleapis.com/auth/youtube.readonly
https://www.googleapis.com/auth/youtube
https://www.googleapis.com/auth/youtube.force-ssl
Use OAuth2 with:
/auth/google → redirects to Google consent
/oauth2/callback → handles the authorization code, exchanges for tokens
Store:
access_token
refresh_token
token_expiry
Associate them with a local “user” record in the SQLite DB using Google sub (user ID) as unique key.
Use the refresh token to regenerate the access token automatically when expired.
4. Database Schema (SQLite)
Create a db.sqlite file in the project root.
Define these tables:
-- Users authenticated via Google OAuth
CREATE TABLE IF NOT EXISTS users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  google_user_id TEXT UNIQUE NOT NULL,
  email TEXT,
  channel_id TEXT,
  access_token TEXT,
  refresh_token TEXT,
  token_expiry INTEGER
);

-- Title tests created by a user
CREATE TABLE IF NOT EXISTS title_tests (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  video_id TEXT NOT NULL,
  video_title_original TEXT NOT NULL,
  status TEXT NOT NULL DEFAULT 'running', -- 'running' | 'stopped' | 'completed'
  rotate_every_minutes INTEGER NOT NULL,
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL,
  FOREIGN KEY (user_id) REFERENCES users(id)
);

-- Individual title variants in a test
CREATE TABLE IF NOT EXISTS title_variants (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  test_id INTEGER NOT NULL,
  variant_index INTEGER NOT NULL, -- 0, 1, 2...
  title TEXT NOT NULL,
  is_current INTEGER NOT NULL DEFAULT 0,
  impressions INTEGER NOT NULL DEFAULT 0,
  views INTEGER NOT NULL DEFAULT 0,
  clicks INTEGER NOT NULL DEFAULT 0,
  last_snapshot_impressions INTEGER NOT NULL DEFAULT 0,
  last_snapshot_views INTEGER NOT NULL DEFAULT 0,
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL,
  FOREIGN KEY (test_id) REFERENCES title_tests(id)
);

-- Tracks when a variant was active
CREATE TABLE IF NOT EXISTS title_rotation_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  test_id INTEGER NOT NULL,
  variant_id INTEGER NOT NULL,
  activated_at INTEGER NOT NULL,
  deactivated_at INTEGER,
  FOREIGN KEY (test_id) REFERENCES title_tests(id),
  FOREIGN KEY (variant_id) REFERENCES title_variants(id)
);
Notes:
impressions, views, clicks are aggregated per variant using deltas from YouTube stats each time we rotate or snapshot.
Approximate CTR per variant as clicks / impressions, where clicks ≈ views.
5. Core Features & Flows
5.1 Authentication Flow
Routes:
GET /auth/google
Initializes OAuth2 client
Redirects to Google with the scopes above
GET /oauth2/callback
Exchanges code for tokens
Fetches:
user profile (people.get or oauth2.userinfo)
YouTube channel info (youtube.channels.list with mine=true)
Upserts user in users table:
google_user_id
email
channel_id
tokens + expiry
Stores user_id in session cookie
Redirects to /dashboard
Use cookie-session to store a simple { userId: number } object.
Create middleware requireAuth to protect routes /dashboard, /tests, etc.
5.2 Dashboard UI
GET /dashboard
Show:
“Connected as: [email]”
A button: “Create New Title Test”
A list of existing tests:
Video thumbnail + title
Status badge (Running, Completed, Stopped)
Best variant (if available) with CTR
Link: “View Results”
Fetch tests joined with video metadata from your DB (no need to hit API here every time).
5.3 Create New Test Flow
Select Video
Route: GET /tests/new
Backend calls:
youtube.search.list with forMine=true and type=video to list recent videos
Show a grid/list:
Thumbnail, title, published date
“Select” button
When user selects video, either:
POST to /tests/new with videoId
or
Move to step 2 on same page via hidden input
Define Test Settings & Variants
Form fields:
Hidden video_id
Read-only current video title
Input: rotate_every_minutes (number, default 120 or 240)
2–5 title variant input fields (title_variants[])
POST /tests
Validate: min 2 variants, max 5, rotate_every_minutes ≥ 30
Create title_tests row
Insert each variant into title_variants
Mark the first variant as is_current=1
Immediately:
Update the video title on YouTube to variant 1 using youtube.videos.update
Insert a row in title_rotation_log with activated_at=now for that variant
Redirect to /tests/:id
5.4 Test Detail Page
GET /tests/:id
Show:
Video thumbnail and link to YouTube
Original title and current live title
Status badge
Rotation interval
Last rotation time
Table of variants:
Variant	Title	Impressions	Views	CTR %	Active?
1	“Title A”	1,230	120	9.7%	●
2	“Title B”	850	95	11.1%	
...	...	...	...	...	
If status is running: button “Stop Test & Pick Winner”
If status is stopped or completed and best variant known:
Button “Set Winner as Final YouTube Title”
Routes:
POST /tests/:id/stop
Set status='stopped'
No more rotations
POST /tests/:id/set-winner
Body contains winner_variant_id
Update video title to winner via youtube.videos.update
Mark status='completed'
6. Rotation & Analytics Logic (Cron)
Use node-cron and start a scheduler when the app boots.
6.1 Scheduler Overview
Every 5 minutes:
Find all title_tests with status='running'
For each test:
Check last rotation time (from title_rotation_log)
If now - last_activated_at >= rotate_every_minutes:
Snapshot metrics for the current variant
Rotate to next variant
Update YouTube title
Insert new row in title_rotation_log for new active variant
6.2 Snapshot Metrics
For each test:
Determine current variant (is_current=1).
Fetch stats from YouTube:
Use youtube.videos.list with:
part=statistics
id=VIDEO_ID
Get:
viewCount
likeCount
If impressionCount is available via Analytics API, use that.
If not, just treat views as clicks and views; keep a placeholder for impressions.
In DB:
Compare current viewCount to last snapshot for that variant:
deltaViews = viewCount - last_snapshot_views
deltaImpressions = impressions - last_snapshot_impressions (when available)
Add deltas to views / impressions / clicks for that variant
Update last_snapshot_views and last_snapshot_impressions
This approximates per-variant performance while each title is active.
7. Middleware & Utilities
7.1 Auth Middleware
Create requireAuth:
Reads req.session.userId
If missing, redirect to /
If present, fetch user from DB and attach to req.user
7.2 YouTube Client Factory
Create a helper function getYouTubeClient(user):
Accepts user row with access_token, refresh_token, token_expiry
If token expired:
Use oauth2Client.refreshToken(refresh_token) to get a new one
Save new access token + expiry in DB
Returns a configured youtube instance from googleapis.youtube
Use this helper everywhere you need YouTube.
8. Routes Summary
Implement at minimum:
GET /
Landing page:
Hero section: "YouTube Title Split-Test Tool"
Button: “Connect with YouTube” → /auth/google
Explain: “Auto-rotate your titles, find the winner by CTR, and set it live.”
GET /auth/google
Start OAuth
GET /oauth2/callback
Handle OAuth callback, save user, redirect to /dashboard
GET /dashboard (auth required)
List user’s tests and “Create New Test”
GET /tests/new (auth required)
Show video picker + form to define test
POST /tests (auth required)
Create test + variants, set first variant live
GET /tests/:id (auth required)
Detailed view of a test and its stats
POST /tests/:id/stop (auth required)
POST /tests/:id/set-winner (auth required)
Also add:
POST /logout to clear session and redirect to /.
9. UI Requirements
Keep UI clean and simple:
Use Tailwind via CDN.
Dark-ish neutral background, white cards.
On /:
Big headline: “Auto A/B Test Your YouTube Titles”
Subtext: “Connect your channel, rotate titles every few hours, and let the data pick the winner.”
On /dashboard:
Card layout for tests
Status badges color-coded:
Running = green
Stopped = yellow
Completed = blue
On /tests/:id:
Use a table with:
Title (truncate with tooltip)
Impressions
Views
CTR %
“Active” pill
Compute CTR as:
const ctr = impressions > 0 ? (clicks / impressions) * 100 : 0;
Display with 1 decimal place.
10. Error Handling & Edge Cases
If YouTube API call fails:
Log the error
Show a flash message on UI like: “We lost access to your YouTube account. Please reconnect.”
If refresh token is invalid/expired:
Delete tokens
Force user to re-auth via /auth/google
Don’t crash the scheduler if one test fails — wrap in try/catch.
11. README
Create a README.md that includes:
What the tool does
That it’s free for creators; only requires YouTube OAuth
How to:
Create a Google Cloud project
Enable YouTube Data API v3
Set OAuth consent screen
Set the GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, GOOGLE_REDIRECT_URI
Explain quota usage:
videos.update is 50 units per call
With 10,000 units/day, a user can comfortably rotate titles across multiple videos
12. Final Behavior
When everything is wired:
Creator lands on /
Clicks “Connect with YouTube”
Auths via Google
Lands on /dashboard
Clicks “Create New Test”
Picks a video
Enters 2–5 titles + rotation interval
Tool:
Sets first title live
Rotates titles on schedule
Fetches stats
Shows per-variant performance
Creator stops test and sets winner as final title.
This should all work end-to-end in a single Replit project.